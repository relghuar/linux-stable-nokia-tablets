// SPDX-License-Identifier: GPL-2.0
/dts-v1/;

#include "omap2420-n8x0-common.dtsi"
#include <dt-bindings/input/input.h>
#include <dt-bindings/leds/common.h>

/ {
	model = "Nokia N810";
	compatible = "nokia,n810", "nokia,n8x0", "ti,omap2420", "ti,omap2";

	vio_ape: vio_ape {
		compatible = "regulator-fixed";
		regulator-name = "vio_ape";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
	};

	v28_aic: v28_aic {
		compatible = "regulator-fixed";
		regulator-name = "v28_aic";
		regulator-min-microvolt = <2800000>;
		regulator-max-microvolt = <2800000>;
	};

	backlight: backlight {
		compatible = "led-backlight";

		leds = <&tahvo_ledpwm>;
		brightness-levels = <
			  0   1   2   3   4   5   6   7
			  8   9  10  11  12  13  14  15
			 16  17  18  19  20  21  22  23
			 24  25  26  27  28  29  30  31
			 32  33  34  35  36  37  38  39
			 40  41  42  43  44  45  46  47
			 48  49  50  51  52  53  54  55
			 56  57  58  59  60  61  62  63
			 64  65  66  67  68  69  70  71
			 72  73  74  75  76  77  78  79
			 80  81  82  83  84  85  86  87
			 88  89  90  91  92  93  94  95
			 96  97  98  99 100 101 102 103
			104 105 106 107 108 109 110 111
			112 113 114 115 116 117 118 119
			120 121 122 123 124 125 126 127>;
		default-brightness-level = <100>;
	};
};

&retu {
	retu_rtc: retu_rtc {
		compatible = "nokia,retu,rtc";
	};
	retu_regs: retu_regs {
		compatible = "nokia,retu,regs";
		nregs = <0x20>;
	};
};

&tahvo {
	tahvo_ledpwm: tahvo_ledpwm {
		compatible = "nokia,tahvo,ledpwm";
	};
	tahvo_vcore: tahvo_vcore {
		compatible = "nokia,tahvo,vcore-regulator";
		regulator-name = "tornado_vcore";
		regulator-min-microvolt = <1005000>;
		regulator-max-microvolt = <1475000>;
		regulator-always-on;
	};
	tahvo_regs: tahvo_regs {
		compatible = "nokia,retu,regs";
		nregs = <0x0e>;
	};
};

&omap2420_pmx {
	mcbsp2_pins: mcbsp2_pins {
		pinctrl-single,pins = <
			OMAP2420_CORE_IOPAD(0x0124, PIN_INPUT | MUX_MODE1)	/* eac_ac_sclk.mcbsp2_clkx */
			OMAP2420_CORE_IOPAD(0x0125, PIN_INPUT | MUX_MODE1)	/* eac_ac_fs.mcbsp2_fsx */
			OMAP2420_CORE_IOPAD(0x0126, PIN_INPUT | MUX_MODE1)	/* eac_ac_din.mcbsp2_dr */
			OMAP2420_CORE_IOPAD(0x0127, PIN_OUTPUT | MUX_MODE1)	/* eac_ac_dout.mcbsp2_dx */
		>;
	};

	aic33_pins: aic33_pins {
		pinctrl-single,pins = <
			OMAP2420_CORE_IOPAD(0x0129, PIN_OUTPUT | MUX_MODE3)	/* eac_ac_rst.gpio118 */
			OMAP2420_CORE_IOPAD(0x00e8, PIN_OUTPUT | MUX_MODE2)	/* vlynq_tx1.sys_clkout2 */
		>;
	};

	n8x0_panel_pins: pinmux_n8x0_panel_pins {
		pinctrl-single,pins = <
			OMAP2420_CORE_IOPAD(0x0098, PIN_OUTPUT | MUX_MODE3)     /* N8X0_LCD_RESET_GPIO, gpmc_nbe1.gpio_30 */
			OMAP2420_CORE_IOPAD(0x00e7, PIN_OUTPUT | MUX_MODE3)     /* N8X0_POWERDOWN_GPIO, vlynq_rx0.gpio_15 */
		>;
	};
	dss_rfbi_pins: pinmux_dss_rfbi_pins {
		pinctrl-single,pins = <
			OMAP2420_CORE_IOPAD(0x00b3, PIN_OUTPUT | MUX_MODE0)     /* dss_d0 */
			OMAP2420_CORE_IOPAD(0x00b4, PIN_OUTPUT | MUX_MODE0)     /* dss_d1 */
			OMAP2420_CORE_IOPAD(0x00b5, PIN_OUTPUT | MUX_MODE0)     /* dss_d2 */
			OMAP2420_CORE_IOPAD(0x00b6, PIN_OUTPUT | MUX_MODE0)     /* dss_d3 */
			OMAP2420_CORE_IOPAD(0x00b7, PIN_OUTPUT | MUX_MODE0)     /* dss_d4 */
			OMAP2420_CORE_IOPAD(0x00b8, PIN_OUTPUT | MUX_MODE0)     /* dss_d5 */
			OMAP2420_CORE_IOPAD(0x00b9, PIN_OUTPUT | MUX_MODE0)     /* dss_d6 */
			OMAP2420_CORE_IOPAD(0x00ba, PIN_OUTPUT | MUX_MODE0)     /* dss_d7 */
			OMAP2420_CORE_IOPAD(0x00bb, PIN_OUTPUT | MUX_MODE0)     /* dss_d8 */
			OMAP2420_CORE_IOPAD(0x00bc, PIN_OUTPUT | MUX_MODE0)     /* dss_d9 */
			OMAP2420_CORE_IOPAD(0x00bd, PIN_OUTPUT | MUX_MODE0)     /* dss_d10 */
			OMAP2420_CORE_IOPAD(0x00be, PIN_OUTPUT | MUX_MODE0)     /* dss_d11 */
			OMAP2420_CORE_IOPAD(0x00bf, PIN_OUTPUT | MUX_MODE0)     /* dss_d12 */
			OMAP2420_CORE_IOPAD(0x00c0, PIN_OUTPUT | MUX_MODE0)     /* dss_d13 */
			OMAP2420_CORE_IOPAD(0x00c1, PIN_OUTPUT | MUX_MODE0)     /* dss_d14 */
			OMAP2420_CORE_IOPAD(0x00c2, PIN_OUTPUT | MUX_MODE0)     /* dss_d15 */
			OMAP2420_CORE_IOPAD(0x00c3, PIN_OUTPUT | MUX_MODE0)     /* dss_d16 */
			OMAP2420_CORE_IOPAD(0x00cb, PIN_OUTPUT | MUX_MODE0)     /* dss_pclk/rdx */
			OMAP2420_CORE_IOPAD(0x00cc, PIN_OUTPUT | MUX_MODE0)     /* dss_vsync/wrx */
			OMAP2420_CORE_IOPAD(0x00cd, PIN_OUTPUT | MUX_MODE0)     /* dss_hsync/csx */
			OMAP2420_CORE_IOPAD(0x00ce, PIN_OUTPUT | MUX_MODE0)     /* dss_acbias/data_en/cmd */
		>;
	};
};

&i2c2 {
	aic33@18 {
		compatible = "ti,tlv320aic33";
		reg = <0x18>;

		pinctrl-names = "default";
		pinctrl-0 = <&aic33_pins>;

		reset-gpios = <&gpio4 22 GPIO_ACTIVE_LOW>; /* gpio118 */

		ai3x-gpio-func = <
			10 /* AIC3X_GPIO1_FUNC_DIGITAL_MIC_MODCLK */
			5 /* AIC3X_GPIO2_FUNC_DIGITAL_MIC_INPUT */
		>;
		ai3x-micbias-vg = <1>; /* 2V */

		AVDD-supply = <&v28_aic>;
		DRVDD-supply = <&v28_aic>;
		IOVDD-supply = <&vio_ape>;
		DVDD-supply = <&vio_ape>;

		assigned-clocks = <&sys_clkout2_src>, <&sys_clkout2>;
		assigned-clock-parents = <&func_96m_ck>;
		assigned-clock-rates = <0>, <12000000>;
	};

	lm8323@45 {
		compatible = "ti,lm8323";
		reg = <0x45>;
		interrupts-extended = <&gpio4 13 IRQ_TYPE_LEVEL_LOW>; // gpio109

		label = "Internal keyboard";
		pwm-names = "n810::keyboard", "n810::cover";

		repeat = <0>;  // Repeat is handled in userspace for now.
		debounce-ms = <30>;
		active-ms = <500>;

		keypad,num-columns = <12>;
		keypad,num-rows = <8>;

		linux,keymap = <
			MATRIX_KEY(0x00, 0x00, KEY_Q)
			MATRIX_KEY(0x00, 0x01, KEY_K)
			MATRIX_KEY(0x00, 0x02, KEY_O)
			MATRIX_KEY(0x00, 0x03, KEY_P)
			MATRIX_KEY(0x00, 0x04, KEY_BACKSPACE)
			MATRIX_KEY(0x00, 0x05, KEY_A)
			MATRIX_KEY(0x00, 0x06, KEY_S)
			MATRIX_KEY(0x00, 0x07, KEY_D)
			MATRIX_KEY(0x00, 0x08, KEY_F)
			MATRIX_KEY(0x00, 0x09, KEY_G)
			MATRIX_KEY(0x00, 0x0a, KEY_H)
			MATRIX_KEY(0x00, 0x0b, KEY_J)

			MATRIX_KEY(0x01, 0x00, KEY_W)
			MATRIX_KEY(0x01, 0x01, KEY_F4)
			MATRIX_KEY(0x01, 0x02, KEY_L)
			MATRIX_KEY(0x01, 0x03, KEY_APOSTROPHE)
			MATRIX_KEY(0x01, 0x05, KEY_Z)
			MATRIX_KEY(0x01, 0x06, KEY_X)
			MATRIX_KEY(0x01, 0x07, KEY_C)
			MATRIX_KEY(0x01, 0x08, KEY_V)
			MATRIX_KEY(0x01, 0x09, KEY_B)
			MATRIX_KEY(0x01, 0x0a, KEY_N)
			MATRIX_KEY(0x01, 0x0b, KEY_LEFTSHIFT) // Actually, this is both shift keys
			MATRIX_KEY(0x01, 0x0e, KEY_F7)

			MATRIX_KEY(0x02, 0x00, KEY_E)
			MATRIX_KEY(0x02, 0x01, KEY_SEMICOLON)
			MATRIX_KEY(0x02, 0x02, KEY_MINUS)
			MATRIX_KEY(0x02, 0x03, KEY_EQUAL)
			MATRIX_KEY(0x02, 0x0a, KEY_LEFTALT) // FN as Left-Alt
			// MATRIX_KEY(0x02, 0x0a, KEY_FN) // Normal FN
			MATRIX_KEY(0x02, 0x0b, KEY_M)
			MATRIX_KEY(0x02, 0x0e, KEY_F8)

			MATRIX_KEY(0x03, 0x00, KEY_R)
			MATRIX_KEY(0x03, 0x01, KEY_RIGHTCTRL)
			MATRIX_KEY(0x03, 0x03, KEY_SPACE)
			MATRIX_KEY(0x03, 0x04, KEY_COMMA)
			MATRIX_KEY(0x03, 0x06, KEY_UP)
			MATRIX_KEY(0x03, 0x0b, KEY_COMPOSE)
			MATRIX_KEY(0x03, 0x0e, KEY_F6)

			MATRIX_KEY(0x04, 0x00, KEY_T)
			MATRIX_KEY(0x04, 0x03, KEY_DOT)
			MATRIX_KEY(0x04, 0x05, KEY_RIGHT)
			MATRIX_KEY(0x04, 0x0e, KEY_F5)

			MATRIX_KEY(0x05, 0x00, KEY_Y)
			MATRIX_KEY(0x05, 0x02, KEY_DOWN)
			MATRIX_KEY(0x05, 0x04, KEY_ENTER)
			MATRIX_KEY(0x05, 0x0e, KEY_ESC)

			MATRIX_KEY(0x06, 0x00, KEY_U)
			MATRIX_KEY(0x06, 0x03, KEY_LEFT)

			MATRIX_KEY(0x07, 0x00, KEY_I)
			MATRIX_KEY(0x07, 0x04, KEY_KPENTER)
			>;
	};

	lp5521@32 {
		compatible = "national,lp5521";
		reg = <0x32>;
		clock-mode = /bits/ 8 <2>;
		label = "rgb";
		enable-gpio = <&gpio1 24 GPIO_ACTIVE_HIGH>;
		interrupts = <&gpio1 27 IRQ_TYPE_EDGE_RISING>;
		#address-cells = <1>;
		#size-cells = <0>;
		chan@0 {
			reg = <0>;
			color = <LED_COLOR_ID_RED>;
			chan-name = "red";
			led-cur = /bits/ 8 <0x2f>;
			max-cur = /bits/ 8 <0x5f>;
			linux,default-trigger = "panic";
		};
		chan@1 {
			reg = <1>;
			color = <LED_COLOR_ID_GREEN>;
			chan-name = "green";
			led-cur = /bits/ 8 <0x2f>;
			max-cur = /bits/ 8 <0x5f>;
		};
		chan@2 {
			reg = <2>;
			color = <LED_COLOR_ID_BLUE>;
			chan-name = "blue";
			led-cur = /bits/ 8 <0x2f>;
			max-cur = /bits/ 8 <0x5f>;
			linux,default-trigger = "heartbeat";
		};

	};
};

&mcbsp2 {
	pinctrl-names = "default";
	pinctrl-0 = <&mcbsp2_pins>;

	status = "okay";
};

&gpio1 {
	ti,no-reset-on-init;
};

&dss {
	status = "okay";
};

&dispc {
	ti,no-reset-on-init;
};

&rfbi {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&dss_rfbi_pins>;

	port {
		rfbi_out: endpoint {
			remote-endpoint = <&lcd_in>;
			data-lines = <24>;
		};
	};
};

&mcspi1 {
	status = "okay";
	ti,spi-num-cs = <2>;
	#address-cells = <1>;
	#size-cells = <0>;

	touch: tsc2005@0 {
		compatible = "ti,tsc2005";
		spi-max-frequency = <6000000>;
		reg = <0>;

		vio-supply = <&vio_ape>;

		reset-gpios = <&gpio3 30 GPIO_ACTIVE_HIGH>; /* 94 */
		interrupts-extended = <&gpio4 10 IRQ_TYPE_EDGE_RISING>; /* 106 */

		touchscreen-fuzz-x = <4>;
		touchscreen-fuzz-y = <7>;
		touchscreen-fuzz-pressure = <2>;
		touchscreen-size-x = <4096>;
		touchscreen-size-y = <4096>;
		touchscreen-max-pressure = <2048>;

		ti,x-plate-ohms = <280>;
		ti,esd-recovery-timeout-ms = <8000>;
	};

	lcd: n8x0_panel@1 {
		compatible = "omapdss,nokia,n8x0_panel";
		spi-max-frequency = <4000000>;
		reg = <1>;

		pinctrl-names = "default";
		pinctrl-0 = <&n8x0_panel_pins>;

		clocks = <&osc_ck>;
		clock-names = "osc_ck";

		label = "lcd";
		reset-gpios = <&gpio1 30 GPIO_ACTIVE_HIGH>; /* 30 */
		powerdown-gpio = <&gpio1 15 GPIO_ACTIVE_HIGH>; /* 15 */

		vtornado-supply = <&tahvo_vcore>;
		vtornado-on-microvolt = <1475000>;
		vtornado-off-microvolt = <1005000>;

		backlight = <&backlight>;

		port {
			lcd_in: endpoint {
				remote-endpoint = <&rfbi_out>;
			};
		};
	};
};

&mcspi2 {
	status = "okay";
	#address-cells = <1>;
	#size-cells = <0>;

	wifi: p54spi@0 {
		compatible = "intersil,p54spi";
		spi-max-frequency = <48000000>;
		reg = <0>;

		power-gpio = <&gpio4 1 GPIO_ACTIVE_HIGH>; /* 97 */
		interrupts-extended = <&gpio3 23 IRQ_TYPE_EDGE_RISING>; /* 87 */
	};
};

